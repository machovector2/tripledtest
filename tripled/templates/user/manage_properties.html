{% extends 'user/base.html' %}
{% load humanize %}

{% block body %}
    <div class="content-page">
        <div class="content">
            <!-- Start Content-->
            <div class="container-fluid">
                <!-- start page title -->
                <div class="row">
                    <div class="col-sm-12">
                        <div class="page-title-box">
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="{% url 'user' %}">Home</a></li>
                                    <li class="breadcrumb-item"><a href="{% url 'frontend_extras' %}">Frontend Extras</a></li>
                                    <li class="breadcrumb-item active">Website Properties</li>
                                </ol>
                            </div>
                            <h4 class="page-title">Manage Website Properties</h4>
                        </div>
                    </div>
                </div>
                <!-- end page title -->

                <div class="row mb-3">
                    <div class="col-12 text-end">
                        <a href="{% url 'create_property_listing' %}" class="btn btn-primary">
                            <i class="ri-add-line me-1"></i> Add New Property
                        </a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title">All Properties</h4>
                                <p class="text-muted font-13 mb-4">
                                    List of all properties. Toggle visibility to show/hide on the public website.
                                </p>

                                <div class="table-responsive">
                                    <table id="basic-datatable" class="table dt-responsive nowrap w-100">
                                        <thead>
                                            <tr>
                                                <th>Image</th>
                                                <th>Name</th>
                                                <th>Location</th>
                                                <th>Plot Size</th>
                                                <th>Visible</th>
                                                <th>Created</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for property in properties %}
                                            <tr>
                                                <td>
                                                    {% if property.main_image %}
                                                    <img src="{{ property.main_image.url }}" alt="Property Image" class="rounded" height="40" width="60" style="object-fit: cover;">
                                                    {% else %}
                                                    <div class="avatar-sm">
                                                        <span class="avatar-title bg-light text-secondary rounded">
                                                            <i class="ri-image-line"></i>
                                                        </span>
                                                    </div>
                                                    {% endif %}
                                                </td>
                                                <td>{{ property.name }}</td>
                                                <td>{{ property.exact_location|default:property.get_location_display }}</td>
                                                <td>{{ property.plot_size|default:"-" }}</td>
                                                <td>
                                                    {% if property.is_visible %}
                                                    <span class="badge bg-success">Visible</span>
                                                    {% else %}
                                                    <span class="badge bg-secondary">Hidden</span>
                                                    {% endif %}
                                                </td>
                                                <td>{{ property.created_at|date:"M d, Y" }}</td>
                                                <td>
                                                    <a href="{% url 'edit_property_listing' property.id %}" class="btn btn-xs btn-info">
                                                        <i class="ri-pencil-line"></i> Edit
                                                    </a>
                                                    <form action="{% url 'delete_property_listing' property.id %}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this property?');">
                                                        {% csrf_token %}
                                                        <button type="submit" class="btn btn-xs btn-danger">
                                                            <i class="ri-delete-bin-line"></i>
                                                        </button>
                                                    </form>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div> <!-- end card body-->
                        </div> <!-- end card -->
                    </div><!-- end col-->
                </div>
                <!-- end row-->

            </div> <!-- container -->
        </div> <!-- content -->
    </div>
{% endblock body %}
